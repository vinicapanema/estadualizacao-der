<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora do IQI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Reduz um pouco a escala para que o conte√∫do caiba melhor */
        .scale-down {
          transform: scale(0.95);
          transform-origin: top center;
        }
        /* Estiliza√ß√£o da tabela de classifica√ß√£o */
        .quality-scale {
          width: 100%;
          text-align: center;
          font-size: 1rem;
        }
        .quality-scale td {
          padding: 10px;
          font-weight: bold;
          color: white;
        }
        .q-0 { background-color: #8B0000; } /* Ausente */
        .q-1-3 { background-color: #FF4500; } /* Baixa qualidade */
        .q-4-5 { background-color: #FFD700; } /* M√©dia qualidade */
        .q-6-7 { background-color: #32CD32; } /* Boa qualidade */
        .q-8-9 { background-color: #008000; } /* Muito boa qualidade */
        .q-10 { background-color: #004d00; } /* √ìtima qualidade */
      </style>
    </head>
    <body>
    
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container">
          <a class="navbar-brand" href="index.html">DER/SP</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item"><a class="nav-link" href="index.html">In√≠cio</a></li>
              <li class="nav-item"><a class="nav-link" href="calculadora-iqi.html">Calculadora IQI</a></li>
            </ul>
          </div>
        </div>
      </nav>
    
      <!-- Cabe√ßalho -->
      <header class="bg-primary text-white py-4">
        <div class="container text-center">
          <h1 class="fw-bold">Calculadora do Indicador de Qualidade da Infraestrutura (IQI)</h1>
        </div>
      </header>
    
      <!-- Se√ß√£o: Explica√ß√£o do IQI -->
      <section class="py-4">
        <div class="container">
          <p class="text-justify">
            O <strong>Indicador de Qualidade da Infraestrutura (IQI)</strong> √© a etapa final do processo de estadualiza√ß√£o, consolidando a <strong>vistoria de campo</strong> em que os elementos de infraestrutura s√£o avaliados. O √≠ndice varia de <strong>0 a 1</strong>, considerando os seguintes elementos:
          </p>
          <ul>
            <li>Faixa de Dom√≠nio (FD)</li>
            <li>Pavimento (P)</li>
            <li>Acostamento (A)</li>
            <li>Sinaliza√ß√£o Vertical (SV)</li>
            <li>Sinaliza√ß√£o Horizontal (SH)</li>
            <li>Sistema de Drenagem (SD)</li>
            <li>Ponte (Po)</li>
            <li>Viaduto (V)</li>
          </ul>
          <div class="text-center">
            <a href="https://vinicapanema.github.io/estadualizacao-der/data/documentacao_iqi.pdf" class="btn btn-outline-primary" target="_blank">
              üìÑ Baixar Documenta√ß√£o do IQI
            </a>
          </div>
        </div>
      </section>
    
      <!-- Se√ß√£o: Calculadora (crit√©rios em coluna √∫nica) -->
      <section id="calculadora-section" class="py-4">
        <div class="container">
          <div class="card shadow p-4 scale-down">
            <h2 class="text-center mb-3">Calculadora IQI</h2>
            <form id="iqi-form">
              <div class="mb-3">
                <label for="faixa-dominio" class="form-label">Faixa de Dom√≠nio (FD) (0-10)</label>
                <input type="number" id="faixa-dominio" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="pavimento" class="form-label">Pavimento (P) (0-10)</label>
                <input type="number" id="pavimento" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="acostamento" class="form-label">Acostamento (A) (0-10)</label>
                <input type="number" id="acostamento" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="sinalizacao-vertical" class="form-label">Sinaliza√ß√£o Vertical (SV) (0-10)</label>
                <input type="number" id="sinalizacao-vertical" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="sinalizacao-horizontal" class="form-label">Sinaliza√ß√£o Horizontal (SH) (0-10)</label>
                <input type="number" id="sinalizacao-horizontal" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="sistema-drenagem" class="form-label">Sistema de Drenagem (SD) (0-10)</label>
                <input type="number" id="sistema-drenagem" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="ponte" class="form-label">Ponte (Po) (0-10)</label>
                <input type="number" id="ponte" class="form-control" min="0" max="10" required>
              </div>
              <div class="mb-3">
                <label for="viaduto" class="form-label">Viaduto (V) (0-10)</label>
                <input type="number" id="viaduto" class="form-control" min="0" max="10" required>
              </div>
            </form>
          </div>
        </div>
      </section>
    
      <!-- Se√ß√£o: Escala de Qualidade (em coluna √∫nica) -->
      <section id="escala-section" class="py-4">
        <div class="container">
          <div class="card shadow p-4 scale-down">
            <h3 class="text-center">Escala de Qualidade</h3>
            <table class="quality-scale table table-bordered">
              <tr><td class="q-0">0 - Ausente</td></tr>
              <tr><td class="q-1-3">1 ‚Äì 3 - Baixa qualidade</td></tr>
              <tr><td class="q-4-5">4 ‚Äì 5 - M√©dia qualidade</td></tr>
              <tr><td class="q-6-7">6 ‚Äì 7 - Boa qualidade</td></tr>
              <tr><td class="q-8-9">8 ‚Äì 9 - Muito boa qualidade</td></tr>
              <tr><td class="q-10">10 - √ìtima qualidade</td></tr>
            </table>
          </div>
        </div>
      </section>
    
      <!-- Se√ß√£o: Resultado e C√°lculo do IQI -->
      <section id="resultado-section" class="py-4">
        <div class="container text-center">
          <button id="calcular-btn" class="btn btn-success mb-3" onclick="calcularIQI()">Calcular IQI</button>
          <h2>Resultado do IQI: <span id="resultado"></span></h2>
        </div>
      </section>
    
      <!-- Se√ß√£o: Laudo de Favorabilidade -->
      <section id="laudo-section" class="py-4">
        <div class="container">
          <div class="card shadow p-4 scale-down">
            <p class="fs-5">Deseja emitir o Laudo de Favorabilidade da Infraestrutura?</p>
            <div class="mb-3">
              <input type="radio" id="laudo-sim" name="emitLaudo" value="sim">
              <label for="laudo-sim">Sim</label>
              &nbsp;&nbsp;
              <input type="radio" id="laudo-nao" name="emitLaudo" value="nao">
              <label for="laudo-nao">N√£o</label>
            </div>
            <!-- Campos para o laudo (inicialmente ocultos) -->
            <div id="report-fields" style="display: none;">
              <div class="mb-3">
                <label for="municipio" class="form-label">Munic√≠pio</label>
                <input type="text" id="municipio" class="form-control">
              </div>
              <div class="mb-3">
                <label for="rodovia" class="form-label">Rodovia/Trecho</label>
                <input type="text" id="rodovia" class="form-control">
              </div>
              <button id="gerar-pdf-btn" class="btn btn-primary" onclick="gerarPDF()">Gerar Relat√≥rio PDF</button>
            </div>
          </div>
        </div>
      </section>
    
      <!-- jsPDF -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
      <script>
        // C√°lculo do IQI com base nos 8 crit√©rios (cada um com peso 1)
        function calcularIQI() {
          const fields = [
            "faixa-dominio", "pavimento", "acostamento",
            "sinalizacao-vertical", "sinalizacao-horizontal",
            "sistema-drenagem", "ponte", "viaduto"
          ];
          let soma = 0;
          for (let field of fields) {
            const valor = parseFloat(document.getElementById(field).value);
            if (isNaN(valor) || valor < 0 || valor > 10) {
              alert("Preencha corretamente todos os campos (valores entre 0 e 10).");
              return;
            }
            soma += valor;
          }
          const iqi = (soma / (fields.length * 10)).toFixed(2);
          document.getElementById("resultado").textContent = iqi;
        }
    
        // Eventos para os bot√µes de emiss√£o do laudo
        document.getElementById("laudo-sim").addEventListener("change", function() {
          if (this.checked) {
            document.getElementById("report-fields").style.display = "block";
          }
        });
        document.getElementById("laudo-nao").addEventListener("change", function() {
          if (this.checked) {
            // Retorna para a p√°gina inicial da calculadora
            window.location.href = "calculadora-iqi.html";
          }
        });
    
        // Gera√ß√£o do PDF conforme o modelo anexado
        function gerarPDF() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
    
          // Obt√©m os valores do formul√°rio e do resultado
          const municipio = document.getElementById("municipio").value;
          const rodovia = document.getElementById("rodovia").value;
          const iqiResult = document.getElementById("resultado").textContent;
          const fields = [
            "faixa-dominio", "pavimento", "acostamento",
            "sinalizacao-vertical", "sinalizacao-horizontal",
            "sistema-drenagem", "ponte", "viaduto"
          ];
          let criterios = {};
          for (let field of fields) {
            criterios[field] = document.getElementById(field).value;
          }
    
          // Composi√ß√£o do PDF (ajuste as posi√ß√µes e textos conforme necess√°rio)
          let y = 10;
          doc.setFontSize(12);
          doc.text("LAUDO DE FAVORABILIDADE DA INFRAESTRUTURA", 105, y, { align: "center" });
          y += 10;
          doc.text("Munic√≠pio: " + municipio, 10, y);
          y += 10;
          doc.text("Rodovia/Trecho: " + rodovia, 10, y);
          y += 10;
          doc.text("----------------------------------------------------", 10, y);
          y += 10;
          doc.text("Crit√©rios e Notas:", 10, y);
          y += 10;
          // Listagem dos crit√©rios
          const labels = {
            "faixa-dominio": "Faixa de Dom√≠nio (FD)",
            "pavimento": "Pavimento (P)",
            "acostamento": "Acostamento (A)",
            "sinalizacao-vertical": "Sinaliza√ß√£o Vertical (SV)",
            "sinalizacao-horizontal": "Sinaliza√ß√£o Horizontal (SH)",
            "sistema-drenagem": "Sistema de Drenagem (SD)",
            "ponte": "Ponte (Po)",
            "viaduto": "Viaduto (V)"
          };
          for (let field of fields) {
            doc.text(labels[field] + ": " + criterios[field], 10, y);
            y += 10;
          }
          doc.text("----------------------------------------------------", 10, y);
          y += 10;
          doc.text("Resultado do IQI: " + iqiResult, 10, y);
          y += 10;
          doc.text("----------------------------------------------------", 10, y);
          y += 10;
          doc.text("INTERPRETA√á√ÉO:", 10, y);
          y += 10;
          doc.text("Grau de Qualidade (0 a 10)  -  Classifica√ß√£o", 10, y);
          y += 10;
          doc.text("0  -  Ausente", 10, y);
          y += 10;
          doc.text("1 ‚Äì 3  -  Baixa qualidade", 10, y);
          y += 10;
          doc.text("4 ‚Äì 5  -  M√©dia qualidade", 10, y);
          y += 10;
          doc.text("6 ‚Äì 7  -  Boa qualidade", 10, y);
          y += 10;
          doc.text("8 ‚Äì 9  -  Muito boa qualidade", 10, y);
          y += 10;
          doc.text("10  -  √ìtima qualidade", 10, y);
          y += 10;
          doc.text("Valor de IQI: quanto mais pr√≥ximo de 1, maior a favorabilidade.", 10, y);
          y += 10;
          doc.text("Indicador de Qualidade de Infraestrutura", 10, y);
    
          // Gera o download do PDF
          doc.save("laudo_infraestrutura.pdf");
        }
      </script>
    </body>
    </html>